# 项目六 Linux网络配置与管理 {#项目六-linux网络配置与管理 .unnumbered}

######## 在互联网时代，计算机系统离不开网络。通过本项目的学习了解Linux系统的网络配置，学会配置Linux网卡，学会使用Linux网络管理命令测试网络。 {#在互联网时代计算机系统离不开网络通过本项目的学习了解linux系统的网络配置学会配置linux网卡学会使用linux网络管理命令测试网络 .unnumbered}

######## 从本项目可以学习到： {#从本项目可以学习到 .unnumbered}

######## Linux系统的网络配置方法

######## Linux系统的常用网络管理命令

本项目建议课时：4课时。

## 6.1 Linux网络配置概述 {#linux网络配置概述 .unnumbered}

使用计算机首先要了解网络配置，本节主要介绍Linux系统的网络配置。

#### 6.1.1相关网络配置文件说明 {#相关网络配置文件说明 .unnumbered}

Linux网络相关的配置文件在不同的Linux发行版中会有所不同，但总体结构都比较类似，表6.1.1列出了Centos8系统的网络配置文件架构。

表6.1.1

  -------------------------------------------- --------------------------------------------------------
  **目录**                                     **说明**

  /etc/sysconfig/network                       该文件用于修改主机名称和是否启动network

  /etc/sysconfig/network-scrips/ifcfg-网卡名   该文件用于设置网卡参数的文件，如IP地址、掩码等

  /etc/resolv.conf                             该文件用于设置DNS相关的信息，用于将域名解析到IP

  /etc/hosts                                   该文件用于设置计算机的IP地址对应的主机名或对应的IP地址
  -------------------------------------------- --------------------------------------------------------

#### 6.1.2为Linux系统配置IP地址 {#为linux系统配置ip地址 .unnumbered}

配置Linux虚拟机的ip地址为"192.168.107.100"、掩码为"255.255.255.0"、网关为"192.168.107.254"。具体配置步骤如下：

使用vi工具编辑网卡配置文件，网卡配置路径为"/etc/sysconfig/network-scrips/ifcfg-网卡名"，其中网卡名根据每台虚拟机的网卡配置，可以通过ifconfig命令查看。本例中网卡名文"ens192"。网卡配置文件如图6.1.1所示。

![Screenshot 2022-07-27 at
10.47.01](media/image1.png){width="4.304166666666666in"
height="2.9145833333333333in"}

图6.1.1

对/etc/sysconfig/network-scrips/ifcfg-ens192配置文件进行修改，修改为如图6.1.2所示。

![Screenshot 2022-07-27 at
10.50.46](media/image2.png){width="3.1881944444444446in"
height="2.451388888888889in"}

图6.1.2

表6.1.3列出了/etc/sysconfig/network-scrips/ifcfg-ens192各项参数的含义。

表6.1.3

  ---------------- ---------------------------------------------------------
  **参数**         **说明**

  TYPE             网络类型，"Ethernet"表示以太网

  BOOTPROTO        动态或者静态IP，"none"和"static"为静态,"dhcp"为动态

  NAME             网络名称，描述符

  DEVICE           网卡设备名称

  NOBOOT           系统启动时是否启动此网络接口，"yes"为启动，"no"为不启动

  IPADDR           IP地址

  NETMASK          子网掩码

  GATEWAY          网关

  DEFROUTE         是否有预设路由
  ---------------- ---------------------------------------------------------

设置完地址参数后，需要重启网络服务才能生效,使用以下命令完成网络服务重启:

systemctl restart NetworkManager

nmcli networking off

nmcli networking on

#### 6.1.3配置主机名 {#配置主机名 .unnumbered}

主机名是识别计算机在网络中的标识，设置主机名可以使用hostnamectl命令。将Linux主机名配置
homeLinux，操作如图6.1.4所示。

![Screenshot 2022-07-27 at
11.54.07](media/image3.png){width="5.764583333333333in"
height="0.6305555555555555in"}

图6.1.4

#### 6.1.4配置DNS服务器地址 {#配置dns服务器地址 .unnumbered}

配置Linux系统的DNS服务器，需要修改配置文件/etc/resolve.conf。将Linux系统的DNS服务器配置为172.16.1.1。配置如图6.1.5所示。

![Screenshot 2022-07-27 at
14.34.51](media/image4.png){width="4.2034722222222225in"
height="0.8513888888888889in"}

图6.1.5

"nameserver
172.16.1.1"是一台DNS服务器的地址。DNS服务器地址可以设置一个或多个，在解析时会按顺序往下解析。

#### 6.1.5 SSH远程管理 {#ssh远程管理 .unnumbered}

###### 1.SSH协议概述 {#ssh协议概述 .unnumbered}

SSH是一款远程管理工具，通过SSH客户端我们可以连接到运行了SSH服务器的主机上并且通过SSH协议来远程控制我们的远程主机。SSH协议在数据传输时是加密的，这提高了数据传输的安全性，并且数据在传输的过程中是压缩的，这样又保证了数据传输的效率。

####### 2.SSH命令格式 {#ssh命令格式 .unnumbered}

ssh \[-p port\] user@remote

user：是在远程机器上的用户名，如果不指定的话默认为当前用户

remote：是远程机器的地址，可以是ip、域名或别名

port：是ssh server监听的端口，如果不指定，就为默认值22

####### 3.SSH配置实例 {#ssh配置实例 .unnumbered}

######## 1）实例说明 {#实例说明 .unnumbered}

在CentOS8主机开启了SSH服务。默认情况下Linux系统会安装好SSH服务并且设置为开机自动启动。在配置SSH服务器时，只需要配置好对应服务器的IP地址。

######## 2）实验环境 {#实验环境 .unnumbered}

表6.1.6列出了实验需要用到的虚拟机

表6.1.6

  ------------------- ------------------------ --------------------------
  **角色**            **操作系统**             **IP地址**

  SSH服务器           Centos8.3                192.168.107.100

  访问客户端          Centos8.3                192.168.107.96
  ------------------- ------------------------ --------------------------

######## 3）具体步骤 {#具体步骤 .unnumbered}

使用vi编辑/etc/sysconfig/network-scrips/ifcfg-ens192网卡配置文件，配置SSH服务器的IP地址。网卡配置如图6.1.6。

![Screenshot 2022-07-27 at
10.50.46](media/image2.png){width="3.095833333333333in"
height="2.3805555555555555in"}

图6.1.6

重新启动网络服务，用于生效网络配置。操作如图6.1.7所示。

![Screenshot 2022-07-27 at
14.51.57](media/image5.png){width="5.767361111111111in"
height="0.6486111111111111in"}

图6.1.7

在客户端使用"ssh root@192.168.107.100"命令连接SSH服务器，如图6.1.8所示。

![Screenshot 2022-07-27 at
14.57.00](media/image6.png){width="5.966666666666667in"
height="1.7166666666666666in"}

图6.1.8

## 6.2 网络管理命令 {#网络管理命令 .unnumbered}

为了更好的进行网络管理配置，需要了解网络管理命令的使用。本节主要介绍Linux系统中常用的网络管理命令。

#### 6.2.1 网络检查命令ping {#网络检查命令ping .unnumbered}

####### 1.命令简介 {#命令简介 .unnumbered}

ping常常用来测试与目标主机是否可达，通过发送ICMP数据包到网络主机，显示响应情况，并根据输出信息来确定目标主机是否可达。由于某些服务器禁ping，从而使得ping命令的结果并不是完全可信的。

####### 2.命令语法 {#命令语法 .unnumbered}

ping \[option\] ip address

option：ping命令的选项

ip address：目标主机ip地址

####### 3.命令参数，如表6.2.1所示 {#命令参数如表6.2.1所示 .unnumbered}

表6.2.1

  ------------------ ------------------------------------------------------
  **参数**           **说明**

  -q                 不显示任何传送封包的信息，只显示最后的结果

  -n                 只输出数值

  -R                 记录路由过程

  -c                 count 总次数

  -i                 时间间隔

  -t                 存活数值：设置存活数值TTL的大小

  -f                 极限检测。大量且快速地送网络封包给一台机器，看其回应
  ------------------ ------------------------------------------------------

####### 4.命令实例演示 {#命令实例演示 .unnumbered}

1）测试地址"192.168.107.254"的联通性(可以ping通的情况)，测试4次。如图6.2.2所示。

![Screenshot 2022-07-27 at 15.07.05](media/image7.png){width="5.5375in"
height="2.1555555555555554in"}

图6.2.2

2.  测试地址"192.168.107.102"是否联通(不可以ping通的情况)，如图6.2.3所示。

    ![Screenshot 2022-07-27 at
    15.11.31](media/image8.png){width="4.514583333333333in"
    height="1.2138888888888888in"}

    图6.2.3

#### 6.2.2 网络配置密令ifconfig {#网络配置密令ifconfig .unnumbered}

####### 1.命令简介 {#命令简介-1 .unnumbered}

ifconfig命令可以用于查看、配置、启用或禁用指定网络接口，如配置网卡的参数等。

####### 2.命令语法 {#命令语法-1 .unnumbered}

ifconfig \[option\] nicname

option：ifconfig命令的选项

nicname：网卡名称

####### 3.命令参数，如表6.2.4所示 {#命令参数如表6.2.4所示 .unnumbered}

表6.2.4

  ---------------------- ------------------------------------------------------
  **参数**               **说明**

  add                    设置网络设备的IP地址

  del                    删除网络设备的IP地址

  up                     启动指定的网络设备

  down                   关闭指定的网络设备

  netmask                设置网络设备的子网掩码

  tunnel                 建立IPv4与IPv6之间的隧道通信地址

  -broadcast             将要送往指定地址的数据包当成广播数据包来处理

  -pointopoint           与指定地址的网络设备建立直接连线，此模式具有保密功能

  -promisc               关闭或启动指定网络设备的promiscuous模式
  ---------------------- ------------------------------------------------------

####### 4.命令实例演示 {#命令实例演示-1 .unnumbered}

1）查看网卡基本信息，如图6.2.5所示。

![Screenshot 2022-07-27 at
15.24.43](media/image9.png){width="5.6305555555555555in"
height="1.957638888888889in"}

图6.2.5

表6.2.6显示了ifconfig命令所列出的每一行命令的含义。

表6.2.6

+--------------------+-------------------------------------------------+
| **行号**           | **说明**                                        |
+--------------------+-------------------------------------------------+
| 第一行             | 连接类型：UP（代表网卡开                        |
|                    | 启状态）RUNNING（代表网卡的网线被接上）MULTICAS |
|                    | T（支持组播）MTU:1500（最大传输单元）：1500字节 |
+--------------------+-------------------------------------------------+
| 第二行             | 网卡的IPv4地址、子网、掩码                      |
|                    |                                                 |
|                    | 本例中的                                        |
|                    | I                                               |
|                    | P地址为"192.168.107.102"，掩码为"255.255.255.0" |
+--------------------+-------------------------------------------------+
| 第三行             | 网卡的IPv6地址、前缀码                          |
+--------------------+-------------------------------------------------+
| 第四行             | Ethernet（以太网）HWaddr（硬件mac地址）         |
+--------------------+-------------------------------------------------+
| 第五、六行         | 接收、发送数据包情况统计                        |
+--------------------+-------------------------------------------------+
| 第七行             | 接收、发送数据字节数统计信息                    |
+--------------------+-------------------------------------------------+
| 第八行             | 接受错误、丢失，冲突等字节数统计                |
+--------------------+-------------------------------------------------+

2）启动和关闭网卡"ens192"。

ifconfig ens192 up

ifconfig ens192 down

3）配置"ens192"网卡的IP地址为"192.168.107.103"，掩码为"255.255.255.0"。

ifconfig ens192 192.168.107.103 netmask 255.255.255.0

4）修改"ens192"网卡的MAC地址为"00:0C:29:7C:08:AA"。

ifconfig ens 192 hw ether 00:0C:29:7C:08:AA

**注意：使用ifconfig命令修改的网卡参数都是临时的，一旦服务器重启所有的指令将失效。**

#### 6.2.3 网络监控命令netstat {#网络监控命令netstat .unnumbered}

####### 1.命令简介 {#命令简介-2 .unnumbered}

netstat命令用于系统网络配置和工作状况，可以显示内核路由表、活动的网络状态以及每个网络接口的流量情况。

####### 2.命令语法 {#命令语法-2 .unnumbered}

netstat \[option\]

option：netstat命令的选项

####### 3.命令参数，如表6.2.6所示 {#命令参数如表6.2.6所示 .unnumbered}

表6.2.6

  -------------------- --------------------------------------------------
  **参数**             **说明**

  -a                   显示所有socket，包括正在监听的

  -c                   每隔1秒就重新显示一遍，直到用户中断它

  -i                   显示所有网络接口的信息，格式同"ifconfig -e"

  -n                   以网络IP地址代替名称，显示出网络连接情况

  -r                   显示核心路由表，格式同"route -e"

  -t                   显示TCP协议的连接情况

  -u                   显示UDP协议的连接情况

  -v                   显示正在进行的工作
  -------------------- --------------------------------------------------

####### 4.命令实例演示 {#命令实例演示-2 .unnumbered}

1）显示所有端口，包含UDP和TCP端口，如图6.2.7所示。

![Screenshot 2022-07-27 at
15.43.47](media/image10.png){width="4.4847222222222225in"
height="2.209722222222222in"}

图6.2.7

2.  显示所有TCP端口，如图6.2.8所示。

    ![Screenshot 2022-07-27 at
    15.44.39](media/image11.png){width="4.522222222222222in"
    height="2.172222222222222in"}

    图6.2.8

3.  显示所有的UDP端口，如图6.2.9所示。

    ![Screenshot 2022-07-27 at
    15.44.52](media/image12.png){width="5.4430555555555555in"
    height="1.7666666666666666in"}

    图6.2.9

4）显示所有处于监听状态的端口并以数字方式显示而非服务器名，如图6.2.10所示。

![Screenshot 2022-07-27 at
15.45.22](media/image13.png){width="5.065277777777778in"
height="1.9125in"}

图6.2.10

5）显示核心路由信息，如图6.2.11所示。

![Screenshot 2022-07-27 at
15.45.40](media/image14.png){width="5.05625in" height="1.175in"}

图6.2.11

6）显示网络接口列表，如图6.2.12所示。

![Screenshot 2022-07-27 at 15.45.53](media/image15.png){width="4.6375in"
height="2.1284722222222223in"}

图6.2.12

#### 6.2.4 路由探测命令traceroute {#路由探测命令traceroute .unnumbered}

####### 1.命令简介 {#命令简介-3 .unnumbered}

traceroute命令用于跟踪数据包到达网络主机所经过的路由。原理是试图以最小的TTL发出探测包来跟踪数据包到达目标主机所经过的网关，然后监听一个来自网关ICMP应答。

####### 2.命令语法 {#命令语法-3 .unnumbered}

traceroute \[option\] ipaddress

option：traceroute命令的选项

ipaddress：ip地址

####### 3.命令参数，如表6.2.13所示 {#命令参数如表6.2.13所示 .unnumbered}

表6.2.13

  ------------------ ----------------------------------------------------
  **说明**           **参数**

  -d                 使用Socket层级的排错功能

  -f                 设置第一个检测数据包的存活数值TTL的大小

  -F                 设置勿离断位

  -g                 设置来源路由网关，最多可设置8个

  -i                 使用指定的网络界面送出数据包

  -l                 使用ICMP回应取代UDP资料信息

  -m                 设置检测数据包的最大存活数值TTL的大小

  -n                 直接使用IP地址而非主机名称

  -p                 设置UDP传输协议的通信端口
  ------------------ ----------------------------------------------------

####### 4.命令实例演示 {#命令实例演示-3 .unnumbered}

1） 显示本地到"www.baidu.com"所经过的路由信息。操作如图6.2.14所示。

![Screen Shot 2021-08-20 at 3.30.57
PM](media/image16.png){width="4.936111111111111in"
height="2.0215277777777776in"}

图6.2.14

#### 6.2.5 下载文件wget {#下载文件wget .unnumbered}

####### 1.命令简介 {#命令简介-4 .unnumbered}

wget类似于Windows中的下载工具，一般发行版Linux都内置了wget工具。

####### 2.命令语法 {#命令语法-4 .unnumbered}

wget \[option\] resource

option：netstat命令的选项

resource：下载资源链接地址

####### 3.命令参数，如表6.2.15所示 {#命令参数如表6.2.15所示 .unnumbered}

表6.2.15

  ------------------- ---------------------------------------------------
  **参数**            **说明**

  -b                  后台执行

  -d                  显示调试信息

  -nc                 不覆盖已有的文件

  -c                  断点续传

  -N                  该参数指定wget只下载更新的文件

  -w time             重试延时（单位秒）

  -S                  显示服务器响应
  ------------------- ---------------------------------------------------

####### 4.命令实例演示 {#命令实例演示-4 .unnumbered}

1）使用wget命令下载"recommended.yaml"文件。使用如下命令：

wget https://raw.githubusercontent.com/kubernetes/recommended.yaml

#### 章节测试： {#章节测试 .unnumbered}

####### 1.操作题 {#操作题 .unnumbered}

1）使用Vmware安装两台Centos8操作系统，并且配置两台虚拟机的网络参数，具体要求如下表所示：

  ----------------- ----------------- ----------------- -----------------
  虚拟机            IP地址            子网掩码          网关

  Centos1           192.168.100.1     255.255.255.0     192.168.100.1

  Centos2           192.168.100.2     255.255.255.0     192.168.100.1
  ----------------- ----------------- ----------------- -----------------

2）网卡配置完毕后，重启Linux系统的网络功能，并利用ipconfig命令查看网卡的IP地址是否为更改的IP地址。

3）使用ping命令测试两台机器的联通性。

4）在Centos1虚拟机上使用SSH工具连接Centos2主机。

5）查看Centos1虚拟机所有的UDP和TCP端口，并输出到/opt/port.txt文件中。
