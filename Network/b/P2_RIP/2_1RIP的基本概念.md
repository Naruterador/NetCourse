### 本章内容概述和教学目标
- RIP (Routing Information Protocol，路由信息协议）是最典型的距离矢量路由协议，常被用于在小型的网络中交互路由信息，它是最先得到广泛使用的 IGP 协议，由于其工作机制相对简单，因此一直以来都作为数通领域入门动态路由技术的协议被大家所熟知。
- 目前 RIP 存在三个版本，分别是面向Iv4的RIPV1 和RIPv2，以及面向IPV6 的RIPng。

- 本章学习目标:
  - 理解 RI P路由更新及接收机制
  - 理解 RIP 度量值
  - 熟悉 RIPV1 及 RIPv2 的报文格式
  - 熟悉 RIP 的几种计时器及其含义
  - 熟悉 RIP 的 静默端口 概念及配置

<br>
<br>

### 2.1.1 RIP 路由更新及接收 
- 每台 RIP 路由器都维护着一个 RIP 数据库 (Database），在该数据库中保存着路由器发现的所有 RIP 路由，其中包括自己发现的直连路由以及从其他路由器收到的路由。
- 在每台运行 RIP 的路由器周期性地将自己的路由表通告出去，当路由器收到 RIP 路由更新时，如果这些路由是自己并未发现的并且是有效的，则将其加载到路由表，同时设置路由的度量值和下一跳地址。

- **1.路由器初始启动**
  - 在图2-1 所示的网络中，R1、R2 和 R3 三台路由器直连，图中每台设备的路由表显示了路由的目的网络地址/网络掩码、协议类型、度量值及出接口。现在我们在这三合路由器上激活 RIP 并观察路由的交互过程。在初始情况下，所有的路由器都能自动发现自己的直连路由，并且将直连路由写入路由表。以 R1 为例，它在其路由表中加载了 192.168.12.0/24 及 1.0.0.0/8 两条直连路由。RIP 将直连路由的度量值视为0跳，因为该直连网段就在 “家门口”。所谓的 “0跳”指的是到达该网段不需要经过任何一台路由器。
- **2.初次交换路由信息**
  - 由于 R1、R2 及R3 都运行了RIP，因此它们都将自己路由表中的路由通过 RIP 协议报文周期性地从所有激活了 RIP 的接口通告出去（RIPV1 使用广播地址作为协议报文的目的 IP 地址，而 RIPv2 则使用组播地址）。对于 R2 而言，它会将自己的路由表从 GE0/0/0 和 GEO/0/1 接口通告出去。以192.168.23.0/24 路由为例，R2 会将关于该路由的更新从 GEO/0/0 接口通告给 R1，它将该路由的度量值设置为 1 跳(0跳加1跳，也就是加上“自己这一跳”）—--- RIP 路由器将自己路由表中的路由通告出去时将跳数加1，而收到该路由更新的 RIP 路由器将路由安装到自己路由表时则使用这个度量值。R1 收到 R2 所通告的路由更新后发现 192.168.23.0/24 路由在其路由表中并不存在，于是将该路由 “学习”过来，加载到路由表中，将路由的度量值设置为1跳（意思是自己要到达 192.168.23.0/24,需要经过一个 RIP 路由器)，此外还将该路由的下一跳设置为路由的更新源 R2 (它从路由更新报文的源地址获得 R2 的 IP 地址），出接口设置为 GE0/0/0。
  - ![2.1](../pics/2.1.png)
  - R3 也会在自己的 GE0/010 接口上收到 R2 通告的路由更新，并学习到路由 192.168.12.0/24，它将该条 RIP 路由加载到路由表中，并将路由的下一跳设置为 R2，出接口设置为 GE0/0/0，度量值设置为 1。而 R2 会在自己的 GEO/0/0 接口上收到 R1 通告的路由更新，在GEO/0/1 接口上收到R了通告的路由更新，并最终学习到 1.0.0.0/8 及 3.0.0.0/8路由，具体过程不再赘述。
  - 经过这一轮路由通告及学习，R1 能够学习到 192.168.23.0/24 路由，R2 能够学习到 1.0.0.0/8 及 3.0.0.0/8 两条路由，而 R3 能够学习到 192.168.12.0/24 路由，如图2-2 所示。
  - ![2.2](../pics/2.2.png) 
- **3.路由完成收敛**
  - 由于运行 RIP 的路由器会周期性地将自己的路由表通告出去，因此在下一个更新周期到来时，所有路由器再次将自己的路由表通告出去。R1 收到 R2 通告的路由后发现路由 3.0.0.0/8 在路由表中并不存在，因此将该条路由学习过来，加载到路由表并关联度量值: 2跳，这意味着 R1 要到达 3.0.0.0/8 需要经过两个路由器。同理，另一边的R3也能够从 R2 学习到 1.0.0.0/8 路由。如此一来，三台路由器都拥有了到达全网各个网段的路由，如图 2-3 所示，而且设备的路由表此时已经稳定，这个阶段被称为“网络中的路由己经完成了收敛”。虽然网络中路由器的路由表已经稳定，但它们依然会周期性地将自己的路由表通过 RIP 通告出去，以确保路由的有效性。
  - ![2.3](../pics/2.3.png)
 
 ### 2.1.2 RIP路由更新与路由表
- RIP 是典型的距离矢量路由协议，从单台 RIP 路由器的角度看，它只是简单地侦听直连的 RIP 路由器所通告的 RIP 路由更新，从该更新中发现 RIP 路由，并将学习到的路由加载到路由表中。另一方面，它也将自己路由表中的 RIP 路由通告出去，以便直连的 RIP 路由器能够学习到。实际上，对于 RIP路由器而言，它并不知晓整个网络的拓扑结构。
- 在图 2-4 中，R1、R2、R3 及 R4 运行了 RIP，初始时，R1 及 R3 需通过 R2 实现连接。R1 将本地直连网段 192.168.1.0/24 发布到了 RIP，从而 R2 能够通过 RIP 学习到该条路由，它将路由加载到自己的路由表中，然后进一步通过 RIP 将该路由通告给 R3，同理，后者学习到路由后将其加载到自己的路由表中，然后通过 RIP 通告给 R4。最终，网络中的4台路由器都能学习到 192.168.1.0/24 路由。
![2.4](../pics/2.4.png)
- 现在 R1 及 R3 之间新增了一条高带宽链路，我们期望将 R3 发往 192.168.1.0/24 的流量引导到这条新增链路上。由于 R1 及R3并不是通过这段新增的链路直接相连（中间还有其他设备），因此无法在它们之间部署 RIP-—直连的网络设备之间才能够通过 RIP 交互路由信息，于是我们在R3 上配置了到达 192.168.1.0/24 的静态路由，下一跳从高带宽链路指向 ISP。由于静态路由的优先级值为 1，而 RIP 路由的优先级值为 120，显然，缺省情况下静态路由的优先级要比 RIP 路由更高，因此 R3 将到达 192.168.1.0/24 的静态路由取代原有的 RIP 路由加载到自己的路由表中。由于路由表中到达 192.168.1.0/24 的 RIP 路由消失，因此 R3 将此前通告给 R4 的该条 RIP 路由撤销，并且在此后其周期性从该接口发送的 RIP 路由更新中也不再包含这条路由。换句话说，R4 无法再通过 RIP学习到该路由。此时就必须通过其他手段，确保 R4 能够拥有到达该网段的路由。